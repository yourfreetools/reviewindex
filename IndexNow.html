<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IndexNow Sitemap Submitter</title>
<style>
body { font-family: sans-serif; padding: 10px; }
textarea { width: 100%; height: 200px; margin-bottom: 10px; }
button { margin-top: 10px; padding: 10px; }
#urls { margin-top: 10px; max-height: 300px; overflow-y: auto; }
label { display: block; margin-bottom: 5px; }
</style>
</head>
<body>
<h2>IndexNow Sitemap Submitter</h2>

<p>Paste your sitemap XML here:</p>
<textarea id="sitemapXml" placeholder="Paste sitemap XML here..."></textarea>
<button id="loadSitemap">Load Sitemap</button>

<div id="urls"></div>
<button id="submitBtn">Submit Selected URLs</button>
<pre id="result"></pre>

<script>
const key = "fda744d3cbef4793b1af0b512bc481a0";
const host = "reviewindex.pages.dev";
const keyLocation = `https://${host}/fda744d3cbef4793b1af0b512bc481a0.txt`;

document.getElementById('loadSitemap').addEventListener('click', () => {
    const xmlText = document.getElementById('sitemapXml').value.trim();
    if(!xmlText) return alert("Please paste your sitemap XML.");

    try {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "application/xml");
        const urls = Array.from(xml.querySelectorAll("url")).map(u => ({
            loc: u.querySelector("loc")?.textContent,
            lastmod: u.querySelector("lastmod")?.textContent
        }));

        // Filter URLs updated in last 1 day
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const recentUrls = urls.filter(u => u.lastmod && new Date(u.lastmod) >= yesterday);

        const urlsDiv = document.getElementById('urls');
        urlsDiv.innerHTML = "";
        recentUrls.forEach(u => {
            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = u.loc;
            checkbox.checked = true;
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(` ${u.loc}`));
            urlsDiv.appendChild(label);
        });

        if(recentUrls.length === 0) urlsDiv.innerHTML = "No URLs updated in the last 1 day.";
    } catch (err) {
        alert("Failed to parse sitemap XML: " + err);
    }
});

document.getElementById('submitBtn').addEventListener('click', async () => {
    const selectedUrls = Array.from(document.querySelectorAll('#urls input:checked')).map(i => i.value);
    if(selectedUrls.length === 0) return alert("Select at least one URL.");

    try {
        const payload = {
            host,
            key,
            keyLocation,
            urlList: selectedUrls
        };

        const response = await fetch("https://api.indexnow.org/IndexNow", {
            method: "POST",
            headers: { "Content-Type": "application/json; charset=utf-8" },
            body: JSON.stringify(payload)
        });

        if(response.ok) {
            document.getElementById('result').textContent = `✅ Successfully submitted ${selectedUrls.length} URL(s).`;
        } else {
            document.getElementById('result').textContent = `❌ Submission failed: ${response.statusText}`;
        }
    } catch (err) {
        document.getElementById('result').textContent = `❌ Error: ${err}`;
    }
});
</script>
</body>
</html>
