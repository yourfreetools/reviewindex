<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IndexNow JSON Generator</title>
<meta name="robots" content="noindex">
<style>
body { font-family: sans-serif; padding: 10px; }
textarea { width: 100%; height: 200px; margin-bottom: 10px; }
button { padding: 10px; margin: 5px 0; }
#links { margin-top: 10px; max-height: 400px; overflow-y: auto; }
label { display: block; margin-bottom: 5px; word-break: break-word; }
#jsonOutput { width: 100%; height: 200px; margin-top: 10px; }
.instructions { background: #f4f4f4; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
</style>
</head>
<body>
<h2>IndexNow JSON Generator</h2>

<div class="instructions">
<strong>Steps to submit:</strong>
<ol>
<li>Paste your sitemap XML below.</li>
<li>Click <strong>Show Latest 10 Links</strong>.</li>
<li>Select the links you want to submit (use Select All / Deselect All buttons if needed).</li>
<li>Copy the generated JSON by clicking <strong>Copy JSON</strong>.</li>
<li>Go to <a href="https://reqbin.com/" target="_blank">ReqBin</a> or another REST client.</li>
<li>Set method: <strong>POST</strong>, URL: <strong>https://api.indexnow.org/IndexNow</strong></li>
<li>Add header: <strong>Content-Type: application/json; charset=utf-8</strong></li>
<li>Paste the copied JSON into the body and click Send.</li>
</ol>
</div>

<textarea id="sitemapXml" placeholder="Paste your sitemap XML here..."></textarea>
<br>
<button id="loadLinks">Show Latest 10 Links</button>
<button id="selectAll">Select All</button>
<button id="deselectAll">Deselect All</button>
<button id="copyJson">Copy JSON to Clipboard</button>

<div id="links"></div>

<textarea id="jsonOutput" readonly placeholder="Generated JSON will appear here..."></textarea>

<script>
// Your IndexNow key and host
const host = "reviewindex.pages.dev";
const key = "fda744d3cbef4793b1af0b512bc481a0";
const keyLocation = `https://${host}/${key}.txt`;

// Load sitemap and display latest 10 posts
document.getElementById('loadLinks').addEventListener('click', () => {
    const xmlText = document.getElementById('sitemapXml').value.trim();
    if(!xmlText) return alert("Please paste your sitemap XML.");

    try {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "application/xml");
        const ns = "http://www.sitemaps.org/schemas/sitemap/0.9";
        const urlElements = xml.getElementsByTagNameNS(ns, "url");

        let urls = Array.from(urlElements).map(u => {
            const locEl = u.getElementsByTagNameNS(ns, "loc")[0];
            const lastmodEl = u.getElementsByTagNameNS(ns, "lastmod")[0];
            let lastmod = lastmodEl ? lastmodEl.textContent.trim().replace(/^"|"$/g, "") : null;
            return { loc: locEl?.textContent, lastmod };
        });

        // Sort by lastmod descending
        urls.sort((a, b) => new Date(b.lastmod) - new Date(a.lastmod));
        urls = urls.slice(0, 10);

        const linksDiv = document.getElementById('links');
        linksDiv.innerHTML = "";

        urls.forEach(u => {
            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = true;
            checkbox.value = u.loc;
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(" " + u.loc));
            linksDiv.appendChild(label);
        });

        generateJSON();

    } catch (err) {
        alert("Failed to parse sitemap XML: " + err);
    }
});

// Generate JSON for selected links
function generateJSON() {
    const selectedUrls = Array.from(document.querySelectorAll('#links input:checked')).map(i => i.value);
    const payload = {
        host,
        key,
        keyLocation,
        urlList: selectedUrls
    };
    document.getElementById('jsonOutput').value = JSON.stringify(payload, null, 2);
}

// Update JSON when checkboxes change
document.getElementById('links').addEventListener('change', generateJSON);

// Copy JSON to clipboard
document.getElementById('copyJson').addEventListener('click', () => {
    const jsonText = document.getElementById('jsonOutput').value;
    if(!jsonText) return alert("No JSON to copy!");
    navigator.clipboard.writeText(jsonText)
        .then(() => alert("JSON copied to clipboard!"))
        .catch(err => alert("Copy failed: " + err));
});

// Select All / Deselect All buttons
document.getElementById('selectAll').addEventListener('click', () => {
    document.querySelectorAll('#links input').forEach(cb => cb.checked = true);
    generateJSON();
});

document.getElementById('deselectAll').addEventListener('click', () => {
    document.querySelectorAll('#links input').forEach(cb => cb.checked = false);
    generateJSON();
});
</script>
</body>
</html>
