<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Uploader - ReviewIndex</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { background: #2c3e50; color: white; padding: 20px; text-align: center; }
        .content { padding: 20px; }
        .drop-zone { border: 2px dashed #ccc; padding: 40px; text-align: center; margin: 20px 0; cursor: pointer; transition: border-color 0.3s; }
        .drop-zone:hover { border-color: #3498db; }
        .preview-section { display: none; margin: 20px 0; }
        .preview-container { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .image-preview { width: 200px; height: 200px; border: 1px solid #ddd; border-radius: 5px; }
        .image-preview img { width: 100%; height: 100%; object-fit: contain; }
        .file-info { flex: 1; min-width: 300px; }
        .info-row { margin-bottom: 10px; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
        .progress-bar { width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .progress { height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71); width: 0%; transition: width 0.3s; }
        button { background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover:not(:disabled) { background: #2980b9; }
        button:disabled { background: #bdc3c7; cursor: not-allowed; }
        .result-section { display: none; background: #e8f5e8; padding: 20px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #2ecc71; }
        .error { background: #ffeaea; color: #d63031; padding: 12px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #d63031; }
        .success { background: #e8f5e8; color: #27ae60; padding: 12px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #27ae60; }
        .url-container { display: flex; gap: 10px; margin: 15px 0; }
        .url-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 3px; font-family: monospace; }
        .loading { color: #7f8c8d; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∏ Image Uploader</h1>
            <p>ReviewIndex - ImageKit.io</p>
        </div>
        
        <div class="content">
            <!-- SDK Loading Status -->
            <div id="sdkStatus" class="loading">Loading ImageKit SDK...</div>

            <div id="dropZone" class="drop-zone">
                <h3>üìÅ Drag & Drop Image Here</h3>
                <p>or click to select file (Max: 32MB)</p>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
            </div>

            <div id="errorContainer"></div>

            <div id="previewSection" class="preview-section">
                <h3>üìã Upload Preview</h3>
                <div class="preview-container">
                    <div class="image-preview">
                        <img id="previewImage" src="" alt="Preview">
                    </div>
                    <div class="file-info">
                        <div class="info-row"><strong>üìÑ File Name:</strong> <span id="fileName"></span></div>
                        <div class="info-row"><strong>üíæ File Size:</strong> <span id="fileSize"></span></div>
                        <div class="info-row"><strong>üìä File Type:</strong> <span id="fileType"></span></div>
                        <div class="info-row">
                            <label><strong>‚úèÔ∏è Custom Name:</strong></label>
                            <input type="text" id="customName" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 3px;" 
                                   placeholder="samsung-galaxy-review.jpg">
                            <small style="color: #666;">Use SEO-friendly names for better search rankings</small>
                        </div>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div id="progressText" style="text-align: center; margin: 5px 0;">0%</div>
                
                <div style="text-align: center;">
                    <button id="uploadBtn">üöÄ Upload Image</button>
                </div>
            </div>

            <div id="resultSection" class="result-section">
                <div class="success">‚úÖ Upload Successful!</div>
                
                <h3>üìé Your Image URL:</h3>
                <div class="url-container">
                    <input type="text" id="imageUrl" class="url-input" readonly>
                    <button onclick="copyUrl()">üìã Copy</button>
                </div>
                
                <div style="margin: 15px 0;">
                    <strong>üëÄ Preview:</strong>
                    <div id="imagePreview" style="margin: 10px 0;"></div>
                </div>
                
                <div style="text-align: center;">
                    <button onclick="resetUploader()" style="background: #27ae60;">üîÑ Upload Another Image</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const publicKey = "public_vmDXUUHWZfFDkQ9SBsciP53Cee0=";
        let currentFile = null;
        let imageKitLoaded = false;

        // Elements
        const sdkStatus = document.getElementById('sdkStatus');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const previewSection = document.getElementById('previewSection');
        const resultSection = document.getElementById('resultSection');
        const errorContainer = document.getElementById('errorContainer');
        const uploadBtn = document.getElementById('uploadBtn');

        // Load ImageKit SDK with error handling
        function loadImageKitSDK() {
            return new Promise((resolve, reject) => {
                // Check if already loaded
                if (typeof ImageKit !== 'undefined') {
                    imageKitLoaded = true;
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = 'https://upload.imagekit.io/api/v1/files/upload.js';
                script.onload = () => {
                    if (typeof ImageKit !== 'undefined') {
                        imageKitLoaded = true;
                        sdkStatus.innerHTML = '<div class="success">‚úÖ ImageKit SDK loaded successfully</div>';
                        resolve();
                    } else {
                        reject(new Error('ImageKit object not found after script load'));
                    }
                };
                script.onerror = () => reject(new Error('Failed to load ImageKit SDK'));
                document.head.appendChild(script);
            });
        }

        // Initialize the uploader
        async function initializeUploader() {
            try {
                await loadImageKitSDK();
                setupEventListeners();
            } catch (error) {
                sdkStatus.innerHTML = `<div class="error">‚ùå Failed to load ImageKit SDK: ${error.message}</div>`;
                showError('Cannot load upload functionality. Please refresh the page or check your internet connection.');
            }
        }

        function setupEventListeners() {
            // File selection
            dropZone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);

            // Drag and drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '#3498db';
                dropZone.style.background = '#f8f9fa';
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.style.borderColor = '#ccc';
                dropZone.style.background = 'white';
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '#ccc';
                dropZone.style.background = 'white';
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect({ target: { files: e.dataTransfer.files } });
                }
            });

            // Upload button
            uploadBtn.addEventListener('click', uploadImage);
        }

        function showError(message) {
            errorContainer.innerHTML = `<div class="error">‚ùå ${message}</div>`;
        }

        function showSuccess(message) {
            errorContainer.innerHTML = `<div class="success">‚úÖ ${message}</div>`;
        }

        function clearMessages() {
            errorContainer.innerHTML = '';
        }

        function handleFileSelect(e) {
            clearMessages();
            const file = e.target.files[0];
            
            if (!file) return;

            // Validate file
            if (!file.type.startsWith('image/')) {
                showError('Please select an image file (JPEG, PNG, GIF, WebP)');
                return;
            }

            if (file.size > 32 * 1024 * 1024) {
                showError('File size must be less than 32MB');
                return;
            }

            currentFile = file;

            // Display file info
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileType').textContent = file.type;
            
            // Set default custom name
            document.getElementById('customName').value = generateSeoName(file.name);

            // Create preview
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImage').src = e.target.result;
            };
            reader.readAsDataURL(file);

            // Show preview section
            previewSection.style.display = 'block';
            resultSection.style.display = 'none';
        }

        function uploadImage() {
            if (!imageKitLoaded) {
                showError('ImageKit SDK not loaded. Please refresh the page.');
                return;
            }

            if (!currentFile) {
                showError('No file selected');
                return;
            }

            clearMessages();
            uploadBtn.disabled = true;
            uploadBtn.textContent = '‚è≥ Uploading...';

            const customName = document.getElementById('customName').value || generateSeoName(currentFile.name);
            const progressBar = document.getElementById('progress');
            const progressText = document.getElementById('progressText');

            // Reset progress
            progressBar.style.width = '0%';
            progressText.textContent = '0%';

            console.log('Starting upload...', {
                fileName: customName,
                fileSize: currentFile.size,
                fileType: currentFile.type,
                imageKitLoaded: imageKitLoaded
            });

            // Simulate progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 85) progress = 85;
                progressBar.style.width = progress + '%';
                progressText.textContent = Math.round(progress) + '%';
            }, 200);

            try {
                // ImageKit upload
                ImageKit.upload({
                    file: currentFile,
                    fileName: customName,
                    publicKey: publicKey,
                    useUniqueFileName: false,
                    folder: "/product-reviews/",
                    tags: ["review", "product"]
                }, function(err, result) {
                    clearInterval(progressInterval);

                    if (err) {
                        console.error('Upload error:', err);
                        showError('Upload failed: ' + (err.message || 'Unknown error. Check browser console.'));
                        uploadBtn.disabled = false;
                        uploadBtn.textContent = 'üöÄ Upload Image';
                        progressBar.style.width = '0%';
                        progressText.textContent = '0%';
                    } else {
                        console.log('Upload success:', result);
                        progressBar.style.width = '100%';
                        progressText.textContent = '100%';
                        
                        // Show success
                        previewSection.style.display = 'none';
                        resultSection.style.display = 'block';
                        
                        const imageUrlElement = document.getElementById('imageUrl');
                        imageUrlElement.value = result.url;
                        
                        // Show preview
                        document.getElementById('imagePreview').innerHTML = 
                            `<img src="${result.url}" style="max-width: 300px; max-height: 200px; border-radius: 5px; margin-top: 10px;" alt="Uploaded image">`;
                        
                        showSuccess('Image uploaded successfully! URL copied to input field.');
                        
                        uploadBtn.disabled = false;
                        uploadBtn.textContent = 'üöÄ Upload Image';
                    }
                });
            } catch (error) {
                clearInterval(progressInterval);
                console.error('Upload exception:', error);
                showError('Upload error: ' + error.message);
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'üöÄ Upload Image';
            }
        }

        function copyUrl() {
            const urlInput = document.getElementById('imageUrl');
            urlInput.select();
            urlInput.setSelectionRange(0, 99999); // For mobile devices
            document.execCommand('copy');
            
            // Visual feedback
            const originalText = urlInput.placeholder;
            urlInput.placeholder = '‚úÖ Copied to clipboard!';
            setTimeout(() => {
                urlInput.placeholder = originalText;
            }, 2000);
        }

        function resetUploader() {
            fileInput.value = '';
            currentFile = null;
            previewSection.style.display = 'none';
            resultSection.style.display = 'none';
            clearMessages();
            uploadBtn.textContent = 'üöÄ Upload Image';
            uploadBtn.disabled = false;
        }

        function generateSeoName(originalName) {
            const ext = originalName.split('.').pop().toLowerCase();
            const name = originalName.replace('.' + ext, '');
            return name
                .toLowerCase()
                .replace(/[^a-z0-9]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '') + '.' + ext;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Start the uploader when page loads
        document.addEventListener('DOMContentLoaded', initializeUploader);
    </script>
</body>
</html>